/*! SnapSVGAnimator 2015-09-01 */
var SVGAnim=function(a){function b(a,b){var c=b.maskElement,d=a.getChildById(b.id);c.clear(),clone=d.el.clone(),clone.attr({visibility:"visible"}),c.append(clone)}function d(a,b,c){function e(a){var b,c;void 0!==m.rootAnimator&&m.rootAnimator.dispose(),b=m.resourceManager.m_data.DOMDocument.Timeline.length-1,c=m.resourceManager.m_data.DOMDocument.Timeline[b],m.movieclip=new j(m.s,c,m.resourceManager,id)}function f(){m.movieclip.play(m.resourceManager),m.playing&&(clearTimeout(k),k=setTimeout(f,1e3/fps)),m.debug&&h()}function g(a){39==a.keyCode&&f()}function h(){function a(b,d){var e,f;for(f=0;f<d.children.length;f+=1){for(e=0;b>e;e+=1)c+="-";c+=d.children[f].id+":"+d.children[f].children.length,d.children[f].isMask&&(c+=" (MASK till:"+d.children[f].maskTill+")"),d.children[f].isMasked&&(c+=" (masked by: "+d.children[f].mask+")"),c+="<br/>",a(b+5,d.children[f])}}var b=document.getElementById("debug"),c="";b||(b=document.createElement("div"),b.id="debug",b.style.position="absolute",b.style.top="0",b.style.right="0",b.style.backgroundColor="black",b.style.color="white",b.style.padding="1em",document.body.appendChild(b)),c+=m.movieclip.id+"<br/>",a(2,m.movieclip),b.innerHTML=c}function i(){}var k,m=this;b=b||100,c=c||100,d.prototype.toString=function(){return console.log("hi"),"SnapSVGAnimator v"+this.version},m.resourceManager=new l(a),m.s=new Snap(b,c),id=m.s.id,m.s.attr("id",id),e(m.s),m.debug&&window.addEventListener("keydown",g),this.play=function(){m.playing=!0,void 0===k&&(k=setTimeout(f,1e3/fps))},this.pause=function(){m.playing=!1,void 0!==k&&(clearTimeout(k),k=void 0)},this.stop=function(){this.pause(),i()},this.setLoop=function(a){m.movieclip.loops=a}}d.version="0.0.2";var e=function(){this.EMPTY_POOL=[],this.REF_POOL=[]};e.prototype.addEmpty=function(a){this.EMPTY_POOL.push(a)},e.prototype.addRef=function(a,b){var c,d;for(c=0;c<this.REF_POOL.length;c+=1)if(this.REF_POOL[c].el.id==a.id){for(d=0;d<b.length;d+=1)this.REF_POOL[c].refs.push(b[d]);return}this.REF_POOL.push({el:a,refs:b})},e.prototype.purge=function(){this.purgeEmptyPool(),this.purgeRefPool()},e.prototype.purgeEmptyPool=function(){var a,b;for(a=this.EMPTY_POOL.length-1;a>-1;a-=1)b=this.EMPTY_POOL[a],0===b.children().length&&(b.remove(),this.EMPTY_POOL.splice(a,1))},e.prototype.purgeRefPool=function(){var a,b,c,d;for(a=this.REF_POOL.length-1;a>-1;a-=1)for(d=this.REF_POOL[a],c=0,b=0;b<d.refs.length;b+=1)d.refs[b].removed&&(c+=1),c==d.refs.length&&(d.el.remove(),this.REF_POOL.splice(a,1))};var f=new e,g=function(a,b,c,d,e,f){var g=this,h=a.el;this.create=function(){var i,j;g.el=a.el.g(),g.id=d,g.el.attr({"class":"shape",token:g.id}),g.children=[],g.isMask=!1,g.isMasked=!1,g.mask=null,g.maskTill=null;for(var k=0;k<b.m_data.DOMDocument.Bitmaps.length;k++)if(b.m_data.DOMDocument.Bitmaps[k].charid==c){var l=b.m_data.DOMDocument.Bitmaps[k].bitmapPath,m=a.el.paper.image(l);g.el.add(m)}i=f.split(","),j=new Snap.Matrix(i[0],i[1],i[2],i[3],i[4],i[5]),g.el.transform(j),e&&0!==parseInt(e)?(afterMC=a.getChildById(parseInt(e)),afterMC.el.before(g.el)):h.add(g.el)},this.create()},h=function(a,b,c,d,e,f,g){var h=this,i=a.el;this.create=function(){var g,j,k;for(h.el=a.el.g(),h.id=d,h.el.attr({"class":"text",token:h.id}),h.children=[],h.isMask=!1,h.isMasked=!1,h.mask=null,h.maskTill=null,g=0;g<b.m_data.DOMDocument.Text.length;g++)b.m_data.DOMDocument.Text[g].charid==c&&h.addText(b.m_data.DOMDocument.Text[g]);j=f.split(","),k=new Snap.Matrix(j[0],j[1],j[2],j[3],j[4],j[5]),h.el.transform(k),e&&0!==parseInt(e)?(afterMC=a.getChildById(parseInt(e)),afterMC.el.before(h.el)):i.add(h.el)},this.addText=function(a){var b,c,d,e,f,i,j,k,l,m,n,o,p;c=h.el.g(),o=g?g.split(","):[0,0,200,100],f=a.behaviour.lineMode,l=a.paras[0].alignment,n="single"==f?"central":"auto",i=a.paras[0].textRun[0].style.fontSize,j=a.paras[0].textRun[0].style.fontName,k=a.paras[0].textRun[0].style.fontColor,letterSpacing=a.paras[0].textRun[0].style.letterSpacing,"left"==l?m="start":"center"==l?m="middle":"right"==l&&(m="end"),p={"text-anchor":m,"dominant-baseline":n,"font-family":j,"font-size":i,"letter-spacing":letterSpacing,fill:k},"false"!==a.behaviour.isBorderDrawn&&(textRect=c.rect(o[0],o[1],o[2],o[3]),textRect.attr({stroke:"black",fill:"transparent"})),"single"==f?(b=c.text(0,0,a.txt),e=parseFloat(o[1])+parseFloat(o[3])/2):(b=h.multiLine(c,a,o,p),e=parseFloat(o[1])-2*parseFloat(a.paras[0].linespacing)),d="left"==l?parseFloat(o[0]):parseFloat(o[0])+parseFloat(o[2])/2,b.attr(p),b.transform("translate("+d+","+e+")")},this.multiLine=function(a,b,c,d){for(var e,f,g,h,i=(b.txt,[]),j="",k=parseFloat(c[2]),l=0;l>-1;)j+=b.txt.charAt(l),f=a.text(0,0,j),f.attr(d),h=f.getBBox(),h.w>k?(newIndex=j.lastIndexOf(" "),e=j.slice(0,newIndex),i.push(e),l=l-(j.length-e.length)+2,j=""):l+=1,l>=b.txt.length&&(e=j.slice(0,newIndex),i.push(e),l=-1),f.remove();return text=a.text(0,0,i),g=text.selectAll("tspan"),g.attr({x:0,dy:h.h+parseFloat(b.paras[0].linespacing)}),text},this.create()},i=function(a,b,c,d,e,f){function g(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null}function h(a,b,c){var d,e;return d=i.el.image(a),e=d.pattern(0,0,b.width,b.height),e.attr({x:c.e,y:c.f}),e}var i=this,j=a.el;this.create=function(){var g,h,k,l;for(i.el=a.el.g(),i.id=d,i.el.attr({"class":"shape",token:i.id}),i.children=[],i.isMask=!1,i.isMasked=!1,i.mask=null,i.maskTill=null,g=0;g<b.m_data.DOMDocument.Shape.length;g++)if(b.m_data.DOMDocument.Shape[g].charid==c)for(h=0;h<b.m_data.DOMDocument.Shape[g].path.length;h++)i.addPath(g,h);k=f.split(","),l=new Snap.Matrix(k[0],k[1],k[2],k[3],k[4],k[5]),i.el.transform(l),e&&0!==parseInt(e)?(afterMC=a.getChildById(parseInt(e)),afterMC.el.before(i.el)):j.add(i.el)},this.addPath=function(a,c){var d;shape=i.el.path(),resourcePath=b.m_data.DOMDocument.Shape[a].path[c],d=resourcePath.d,shape.attr({fill:"transparent"}),shape.attr({d:d}),"Fill"==resourcePath.pathType?this.addFill(shape,resourcePath):"Stroke"==resourcePath.pathType&&this.addStroke(shape,resourcePath)},this.getFillColor=function(a){var b,c,d,e,f,g;return b=resourcePath.color,c=parseInt(b.substring(1,3),16),d=parseInt(b.substring(3,5),16),e=parseInt(b.substring(5,7),16),f=resourcePath.colorOpacity,g="rgba("+c+","+d+","+e+","+f+")"},this.getFillImage=function(b){var c,d,e,f,g=0;return c=b.patternTransform.split(","),g=0,d=new Snap.Matrix(c[g],c[g+1],c[g+1],c[g+3],c[g+4],c[g+5]),e=b.bitmapPath,f=a.el.paper.select("defs pattern image"),f&&f.attr("href")==e?fillImage=f.parent():fillImage=h(e,b,d),fillImage},this.getFillGradient=function(b,c,d){var e,f,h,i,j,k,l,m,n,o;for("linear"==c?(e=parseFloat(b.x1),f=parseFloat(b.y1),h=parseFloat(b.x2),i=parseFloat(b.y2),l="L(",l+=e+", ",l+=f+", ",l+=h+", ",l+=i+")"):(e=d.getBBox().x+d.getBBox().width/2+b.cx/10,f=d.getBBox().y+d.getBBox().height/2+b.cy/10,j=d.getBBox().x+d.getBBox().width/2+parseFloat(b.fx),k=d.getBBox().y+d.getBBox().height/2+parseFloat(b.fy),l="R(",l+=e+", ",l+=f+", ",l+=b.r+", ",l+=j+", ",l+=k+")"),n=0;n<b.stop.length;n+=1)o=g(b.stop[n].stopColor),l+="rgba("+o.r+","+o.g+","+o.b+","+b.stop[n].stopOpacity+")",l+=":",l+=b.stop[n].offset,n!==b.stop.length-1&&(l+="-");return m=a.el.paper.gradient(l)},this.addFill=function(a,b){var c,d,e,f,g;b.color&&(c=i.getFillColor(b),a.attr({fill:c})),b.image&&(f=b.image,d=i.getFillImage(f),a.attr({fill:d})),b.linearGradient&&(g=b.linearGradient,e=i.getFillGradient(g,"linear"),a.attr({fill:e})),b.radialGradient&&(g=b.radialGradient,e=i.getFillGradient(g,"radial",a),a.attr({fill:e}))},this.addStroke=function(a,b){var c,d,e,f,g;b.color&&(clr=b.color,c=parseInt(clr.substring(1,3),16),d=parseInt(clr.substring(3,5),16),e=parseInt(clr.substring(5,7),16),f=b.colorOpacity,g="rgba("+c+","+d+","+e+","+f+")",a.attr({stroke:g,strokeWidth:b.strokeWidth}))},this.create()},j=function(a,b,c,d,e,f){var g,h,i,j="svg"==a.type?a:a.el;d&&(this.id=d),this.el=j.g(),this.el.attr({"class":"movieclip",token:this.id}),this.transform=f,this.m_timeline=b,this.m_currentFrameNo=0,this.m_frameCount=this.m_timeline.frameCount,this.children=[],this.isMask=!1,this.isMasked=!1,this.mask=null,this.maskElement=null,this.maskTill=null,this.loops=!0,void 0!==this.transform&&(h=this.transform,i=h.split(","),g=new Snap.Matrix(i[0],i[1],i[2],i[3],i[4],i[5]),this.el.transform(g)),e&&0!==parseInt(e)?(afterMC=a.getChildById(parseInt(e)),afterMC.el.before(this.el)):j.add(this.el)};j.prototype.getChildById=function(a){var b;for(b=0;b<this.children.length;b+=1)if(this.children[b].id==a)return this.children[b];return!1},j.prototype.getChildIndexById=function(a){var b;for(b=0;b<this.children.length;b+=1)if(this.children[b].id==a)return b;return!1},j.prototype.removeChildById=function(a){var b;for(b=0;b<this.children.length;b+=1)if(this.children[b].id==a)return void this.children.splice(b,1)},j.prototype.swapChildIndex=function(a,b){var c,d;for(c=0;c<this.children.length;c+=1)if(this.children[c].id==a){d=this.children.splice(c,1);break}for(c=0;c<this.children.length;c+=1)if(this.children[c].id==b){this.children.splice(c+1,0,d[0]);break}},j.prototype.insertAtIndex=function(a,b){var c;for(0===parseInt(b)&&this.children.unshift(a),c=0;c<this.children.length;c+=1)if(this.children[c].id==b){this.children.splice(c+1,0,a);break}},j.prototype.containsMask=function(){var a;for(a=0;a<this.children.length;a+=1)if(this.children[a].isMask)return!0;return!1},j.prototype.loop=function(a){var b,d,e,f,g;for(this.m_currentFrameNo=0,e=0;e<this.m_timeline.Frame.length;e+=1){if(parseInt(this.m_timeline.Frame[e].num)==this.m_currentFrameNo){b=this.m_timeline.Frame[e];break}if(e>=this.m_timeline.Frame.length-1)return}if(b)for(d=b.Command,e=0;e<this.children.length;e+=1){for(f=!1,child=this.children[e],c=0;c<d.length;++c)if(cmdData=d[c],g=cmdData.cmdType,"Place"==g&&parseInt(child.id)==parseInt(cmdData.objectId)){f=!0;break}f===!1&&(command=new k.RemoveObjectCommand(child.id),a.push(command))}},j.prototype.play=function(a){var b,c,d,e,g,h,i,j,l=[];for(c=0;c<this.children.length;c+=1)this.children[c].play&&this.children[c].play(a);if(this.m_currentFrameNo==this.m_frameCount){if(!this.loops)return;this.loop(l)}for(c=0;c<this.m_timeline.Frame.length;c+=1){if(parseInt(this.m_timeline.Frame[c].num)==this.m_currentFrameNo){b=this.m_timeline.Frame[c];break}if(c>=this.m_timeline.Frame.length-1)return void(this.m_currentFrameNo+=1)}if(b){for(g=b.Command,d=0;d<g.length;d+=1)switch(i=g[d],j=i.cmdType,h=null,j){case"Place":e=this.getChildById(i.objectId),e?(h=new k.MoveObjectCommand(i.objectId,i.transformMatrix),l.push(h),h=new k.UpdateObjectCommand(i.objectId,i.placeAfter),l.push(h)):(h=new k.PlaceObjectCommand(i.charid,i.objectId,i.placeAfter,i.transformMatrix,i.bounds),l.push(h));break;case"Move":h=new k.MoveObjectCommand(i.objectId,i.transformMatrix),l.push(h);break;case"Remove":h=new k.RemoveObjectCommand(i.objectId),l.push(h);break;case"UpdateZOrder":h=new k.UpdateObjectCommand(i.objectId,i.placeAfter),l.push(h);break;case"UpdateVisibility":h=new k.UpdateVisibilityCommand(i.objectId,i.visibility),l.push(h);break;case"UpdateColorTransform":h=new k.UpdateColorTransformCommand(i.objectId,i.colorMatrix),l.push(h);break;case"UpdateMask":h=new k.UpdateMaskCommand(i.objectId,i.maskTill),l.push(h)}for(this.containsMask&&(h=new k.ApplyMaskCommand,l.push(h)),c=0;c<l.length;c++)void 0!==l[c]&&l[c].execute(this,a);this.m_currentFrameNo++,f.purge()}};var k={};k.PlaceObjectCommand=function(a,b,c,d,e){this.m_charID=a,this.m_objectID=b,this.m_placeAfter=c,this.m_transform=d,this.m_bounds=e},k.PlaceObjectCommand.prototype.execute=function(a,b){var c,d,e,f,k,l=b.getShape(this.m_charID),m=b.getBitmap(this.m_charID),n=b.getText(this.m_charID);null!==l&&void 0!==l?(d=new i(a,b,this.m_charID,this.m_objectID,this.m_placeAfter,this.m_transform),a.insertAtIndex(d,this.m_placeAfter)):null!==m&&void 0!==m?(e=new g(a,b,this.m_charID,this.m_objectID,this.m_placeAfter,this.m_transform),a.insertAtIndex(e,this.m_placeAfter)):null!==n&&void 0!==n?(c=new h(a,b,this.m_charID,this.m_objectID,this.m_placeAfter,this.m_transform,this.m_bounds),a.insertAtIndex(c,this.m_placeAfter)):(f=b.getMovieClip(this.m_charID),f&&(k=new j(a,f,b,this.m_objectID,this.m_placeAfter,this.m_transform),a.insertAtIndex(k,this.m_placeAfter),k.play(b)))},k.MoveObjectCommand=function(a,b){this.m_objectID=a,this.m_transform=b},k.MoveObjectCommand.prototype.execute=function(a,b){var c,d,e;c=this.m_transform,d=c.split(","),e=new Snap.Matrix(d[0],d[1],d[2],d[3],d[4],d[5]),child=a.getChildById(this.m_objectID),child.el.transform(e)},k.UpdateObjectCommand=function(a,b){this.m_objectID=a,this.m_placeAfter=b},k.UpdateObjectCommand.prototype.execute=function(a,b){},k.RemoveObjectCommand=function(a){this.m_objectID=a},k.RemoveObjectCommand.prototype.execute=function(a,b){var c;c=a.getChildById(this.m_objectID),c.el.remove(),a.removeChildById(this.m_objectID)},k.UpdateVisibilityCommand=function(a,b){this.m_objectID=a,this.m_visibility=b},k.UpdateVisibilityCommand.prototype.execute=function(a,b){var c,d;c=a.getChildById(this.m_objectID),d="true"==this.m_visibility?"visible":"hidden",c.el.attr({visibility:d})},k.UpdateMaskCommand=function(a,b){this.m_objectID=a,this.m_maskTill=b},k.UpdateMaskCommand.prototype.execute=function(a,b){var c,d;maskContent=a.getChildById(this.m_objectID),maskContent.isMask=!0,maskContent.maskTill=this.m_maskTill,c=a.el.mask(),c.attr("mask-type","alpha"),clone=maskContent.el.clone(),clone.attr({visibility:"visible"}),d=c.toDefs(),d.append(clone),maskContent.maskElement=d,maskContent.el.attr({visibility:"hidden"})},k.ApplyMaskCommand=function(){},k.ApplyMaskCommand.prototype.execute=function(a,c){var d,e,g=!1,h=null,i=null,j=null;for(d=0;d<a.children.length;d+=1)child=a.children[d],child.isMask?(b(a,child),g=!0,h=child,i=child.maskElement,j=child.maskTill,e=a.el.g(),e.attr({"class":"maskGroup"}),child.el.after(e),e.attr({mask:i}),f.addEmpty(e),f.addRef(i,[e]),child.id==child.maskTill&&(g=!1)):g&&(e.prepend(child.el),child.isMasked=!0,child.mask=h.id,child.id==j&&(g=!1,h=null,j=null))},k.UpdateColorTransformCommand=function(a,b){this.m_objectID=a,this.m_colorMatrix=b},k.UpdateColorTransformCommand.prototype.execute=function(a,b){var c,d;c=a.getChildById(this.m_objectID),d=this.m_colorMatrix.split(",",7),c.el.attr({opacity:parseFloat(d[6])})};var l=function(a){var b;this.m_shapes=[],this.m_movieClips=[],this.m_bitmaps=[],this.m_text=[],this.m_data=a;for(var c=0;c<this.m_data.DOMDocument.Shape.length;c++){b=this.m_data.DOMDocument.Shape[c].charid;var d=this.m_data.DOMDocument.Shape[c];this.m_shapes[b]=d}for(var e=0;e<this.m_data.DOMDocument.Bitmaps.length;e++){b=this.m_data.DOMDocument.Bitmaps[e].charid;var f=this.m_data.DOMDocument.Bitmaps[e];this.m_bitmaps[b]=f}for(var g=0;g<this.m_data.DOMDocument.Text.length;g++){b=this.m_data.DOMDocument.Text[g].charid;var h=this.m_data.DOMDocument.Text[g];this.m_text[b]=h}if(void 0!==this.m_data.DOMDocument.Timeline)for(var i=0;i<this.m_data.DOMDocument.Timeline.length-1;i++){b=this.m_data.DOMDocument.Timeline[i].charid;var j=this.m_data.DOMDocument.Timeline[i];this.m_movieClips[b]=j}console.log(this.m_data.DOMDocument)};return l.prototype.getShape=function(a){return this.m_shapes[a]},l.prototype.getMovieClip=function(a){return this.m_movieClips[a]},l.prototype.getBitmap=function(a){return this.m_bitmaps[a]},l.prototype.getText=function(a){return this.m_text[a]},window.SVGAnim=d,d}(window||this);